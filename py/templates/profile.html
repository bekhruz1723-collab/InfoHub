{% extends "base.html" %} {% block content %}
<div class="glass-card" style="max-width: 600px; margin: 0 auto">
	<form method="POST" enctype="multipart/form-data">
		<div style="text-align: center; margin-bottom: 20px">
			<div class="file-upload-wrapper">
				<img
					src="{% if user.avatar and user.avatar.startswith('http') %}{{ user.avatar }}{% else %}{{ url_for('static', filename='uploads/' + (user.avatar or 'default.svg')) }}{% endif %}"
					id="avatarPreview"
					style="
						width: 120px;
						height: 120px;
						border-radius: 50%;
						object-fit: cover;
						border: 3px solid var(--accent-color);
						margin-bottom: 10px;
					"
				/>
				<br />
				<label for="avatarInput" class="file-upload-label">{{ _('profile_change_avatar') }}</label>
				<input
					type="file"
					name="avatar"
					id="avatarInput"
					style="display: none"
					accept="image/*"
					onchange="document.getElementById('avatarPreview').src = window.URL.createObjectURL(this.files[0])"
				/>
			</div>

			<h2>{{ user.username }}</h2>
			<p style="opacity: 0.7">@{{ user.nickname }}</p>
		</div>

		<label>{{ _('profile_username_label') }}</label>
		<input type="text" name="username" value="{{ user.username }}" />

		<label>{{ _('profile_bio_label') }}</label>
		<textarea name="bio" rows="3">{{ user.bio or '' }}</textarea>

		<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px">
			<div>
				<label>{{ _('profile_age_label') }}</label>
				<input
					type="number"
					name="age"
					value="{{ user.age or '' }}"
					placeholder="{{ _('profile_age_placeholder') }}"
				/>
			</div>
			<div>
				<label>{{ _('profile_gender_label') }}</label>
				<select name="gender">
					<option value="" {% if not user.gender %}selected{% endif %}>
						{{ _('profile_gender_not_specified') }}
					</option>
					<option value="Male" {% if user.gender == 'Male' %}selected{% endif %}>
						{{ _('profile_gender_male') }}
					</option>
					<option value="Female" {% if user.gender == 'Female' %}selected{% endif %}>
						{{ _('profile_gender_female') }}
					</option>
				</select>
			</div>
		</div>

		<label>{{ _('profile_goals_label') }}</label>
		<textarea name="goals" placeholder="{{ _('profile_goals_placeholder') }}">
{{ user.goals or '' }}</textarea
		>

		<button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px">
			{{ _('profile_save_changes') }}
		</button>
	</form>

	<div
		style="
			margin-top: 40px;
			padding-top: 20px;
			border-top: 1px solid rgba(255, 255, 255, 0.1);
			display: flex;
			flex-direction: column;
			gap: 15px;
		"
	>
		<a
			href="{{ url_for('logout') }}"
			class="btn-outline"
			style="
				text-align: center;
				text-decoration: none;
				display: block;
			"
			>{{ _('profile_logout') }}</a
		>

		<button
			onclick="openDeleteModal()"
			class="btn-danger"
			style="width: 100%"
		>
			{{ _('profile_delete') }}
		</button>
	</div>
</div>

<div id="deleteModal" class="modal-overlay">
	<div class="modal-content animate-modal">
		<h2 style="color: var(--danger-color)">{{ _('profile_delete_modal_title') }}</h2>
		<p>
			{{ _('profile_delete_modal_text') | safe }}
		</p>
		<div class="modal-actions">
			<button
				class="btn-primary"
				style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white"
				onclick="closeDeleteModal()"
			>
				{{ _('profile_delete_modal_cancel') }}
			</button>
			<form action="{{ url_for('delete_account') }}" method="POST">
				<button type="submit" class="btn-danger">{{ _('profile_delete_modal_confirm') }}</button>
			</form>
		</div>
	</div>
</div>

<script>
	function openDeleteModal() {
		const modal = document.getElementById("deleteModal");
		modal.style.display = "flex";
	}
	function closeDeleteModal() {
		document.getElementById("deleteModal").style.display = "none";
	}
</script>
{% endblock %}