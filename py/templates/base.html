<!DOCTYPE html>
<html lang="{{ current_lang }}">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{{ _('site_title') }}</title>
		<link
			rel="stylesheet"
			href="{{ url_for('static', filename='css/style.css') }}"
		/>
		<link
			rel="icon"
			href="{{ url_for('static', filename='uploads/logo.png') }}"
			type="image/png"
		/>
		<script
			src="https://cdn.plot.ly/plotly-2.35.2.min.js"
			charset="utf-8"
		></script>
	</head>
	<body>
		<div class="container">
			<nav class="glass-card">
				<a href="{{ url_for('dashboard') }}" class="logo-container">
					<img
						src="{{ url_for('static', filename='uploads/logo.png') }}"
						alt="Logo"
						style="height: 40px; width: auto"
						onerror="this.style.display='none'"
					/>
					<div class="site-title">{{ _('site_title') }}</div>
				</a>
				<div class="nav-links">
					{% if current_user.is_authenticated %}
					<a
						href="{{ url_for('dashboard') }}"
						class="{{ 'active' if request.endpoint == 'dashboard' else '' }}"
						>{{ _('nav_home') }}</a
					>
					<a
						href="{{ url_for('search') }}"
						class="{{ 'active' if request.endpoint == 'search' else '' }}"
						>{{ _('nav_search') }}</a
					>
					<a
						href="{{ url_for('profile') }}"
						class="{{ 'active' if request.endpoint == 'profile' else '' }}"
						>{{ _('nav_profile') }}</a
					>
					{% else %}
					<a
						href="{{ url_for('login') }}"
						class="{{ 'active' if request.endpoint == 'login' else '' }}"
						>{{ _('nav_login') }}</a
					>
					<a
						href="{{ url_for('register') }}"
						class="{{ 'active' if request.endpoint == 'register' else '' }}"
						>{{ _('nav_register') }}</a
					>
					{% endif %}

					<div class="lang-dropdown">
						<button class="lang-btn" id="langBtn">
							{% if current_lang == 'ru' %}RU
							{% elif current_lang == 'en' %}EN
							{% else %}UZ{% endif %}
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left: 4px;">
								<polyline points="6 9 12 15 18 9"></polyline>
							</svg>
						</button>
						<div class="lang-dropdown-menu" id="langMenu">
							<a href="{{ url_for('change_language', lang='ru') }}" class="lang-dropdown-item">
								<span>Русский</span>
								{% if current_lang == 'ru' %}
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
								{% endif %}
							</a>
							<a href="{{ url_for('change_language', lang='en') }}" class="lang-dropdown-item">
								<span>English</span>
								{% if current_lang == 'en' %}
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
								{% endif %}
							</a>
							<a href="{{ url_for('change_language', lang='uz') }}" class="lang-dropdown-item">
								<span>O'zbek</span>
								{% if current_lang == 'uz' %}
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<polyline points="20 6 9 17 4 12"></polyline>
								</svg>
								{% endif %}
							</a>
						</div>
					</div>

					{% if current_user.is_authenticated %}
					<button
						id="theme-toggle"
						class="theme-btn"
						title="{{ _('theme_toggle') }}"
						onclick="toggleTheme()"
					>
						<svg
							id="icon-sun"
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
						>
							<circle cx="12" cy="12" r="5"></circle>
							<line x1="12" y1="1" x2="12" y2="3"></line>
							<line x1="12" y1="21" x2="12" y2="23"></line>
							<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
							<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
							<line x1="1" y1="12" x2="3" y2="12"></line>
							<line x1="21" y1="12" x2="23" y2="12"></line>
							<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
							<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
						</svg>
						<svg
							id="icon-moon"
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							style="display: none"
						>
							<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
						</svg>
					</button>
					{% endif %}
				</div>
			</nav>

			{% with messages = get_flashed_messages(with_categories=true) %} {% if
			messages %} {% for category, message in messages %}
			<div
				class="glass-card"
				style="margin-bottom: 20px; border-left: 4px solid {{ '#ef4444' if category == 'danger' else '#10b981' }}; padding: 15px;"
			>
				{{ message }}
			</div>
			{% endfor %} {% endif %} {% endwith %} {% block content %}{% endblock %}
		</div>

		<script>
			function toggleTheme() {
				const body = document.body;
				const isLight = body.getAttribute("data-theme") === "light";
				if (isLight) {
					body.removeAttribute("data-theme");
					localStorage.setItem("theme", "dark");
					updateIcon(false);
				} else {
					body.setAttribute("data-theme", "light");
					localStorage.setItem("theme", "light");
					updateIcon(true);
				}
				if (typeof Plotly !== "undefined") {
					const chart = document.getElementById("chart");
					if (chart) {
						Plotly.relayout(chart, {});
					}
				}
			}

			function updateIcon(isLight) {
				const sun = document.getElementById("icon-sun");
				const moon = document.getElementById("icon-moon");
				if (!sun || !moon) return;

				if (isLight) {
					sun.style.display = "none";
					moon.style.display = "block";
				} else {
					sun.style.display = "block";
					moon.style.display = "none";
				}
			}

			(function () {
				const savedTheme = localStorage.getItem("theme");
				if (savedTheme === "light") {
					document.body.setAttribute("data-theme", "light");
					document.addEventListener("DOMContentLoaded", () => updateIcon(true));
				} else {
					document.addEventListener("DOMContentLoaded", () =>
						updateIcon(false)
					);
				}
			})();

			// Language dropdown
			const langBtn = document.getElementById('langBtn');
			const langMenu = document.getElementById('langMenu');

			if (langBtn && langMenu) {
				langBtn.addEventListener('click', function(e) {
					e.stopPropagation();
					langMenu.classList.toggle('show');
				});

				// Close dropdown when clicking outside
				document.addEventListener('click', function(e) {
					if (!langBtn.contains(e.target) && !langMenu.contains(e.target)) {
						langMenu.classList.remove('show');
					}
				});
			}
		</script>
	</body>
</html>